<%- include('../partials/top.ejs') %>
<small id="geo-status"></small>

<div class="list-box">
  <ul>
    <li>
      <div class="entry-info"><h2><%=place.name%></h2></div>
      <div class="entry-controls">
        <!-- ADD REPORT CARD BUTTON  -->
        <form action="/places/<%=place._id%>/reportcards/new" method="GET">
          <button title="Add A Report"><span class="material-icons"> thumbs_up_down </span> Add Report</button>
        </form>
        <!-- EDIT PLACE BUTTON  -->
        <form action="/places/<%=place._id%>/edit" method="GET">
          <button title="Edit Place Details"><span class="material-icons"> edit_location_alt </span>Edit Place</button>
        </form>

        <!-- DELETE PLACE BUTTON  -->
        <!-- only available for authoring user  -->
        <% if (place.authorUserId.equals(user && user._id)) { %>
        <form action="/places/<%=place._id%>?_method=DELETE" method="POST">
          <button class="danger" title="Delete Place"><span class="material-icons"> clear </span>Delete Place</button>
        </form>
        <% } %>
      </div>
    </li>
  </ul>
</div>

<!-- use to pass data from server to front end -->
<data class="geo-data" data-name="<%=place.name%>" data-lat="<%=place.loc.coordinates[0]%>" data-lng="<%=place.loc.coordinates[1]%>"></data>
<a href="/places"> Back to List of All Places</a>

<h5>Report Card(s)</h5>

<!-- List Report Cards for this PLACE -->
<div class="list-box">
  <ul>
    <li class="entry-header">
      <div class="entry-info-header">Report</div>
      <div class="entry-controls-header">Delete Your Report</div>
    </li>
    <!-- if statement below with || it to limit scope to just changing tables... eventually rf to display relevant properties -->
    <% place.reportcards.forEach(reportcard => { %> <% if (reportcard.hasChangingTableW || reportcard.hasChangingTableM) { %>
    <li class="entries">
      <div class="entry-info">
        <span class="date"><%= reportcard.createdAt.toLocaleString('en-US',{year: 'numeric', month: 'short', day: 'numeric'}) %></span>

        <span class="material-icons"> baby_changing_station </span>
        <%= reportcard.hasChangingTableW ? '(W)' : '' %> <%= reportcard.hasChangingTableM ? '(M)' : '' %>
      </div>
      <div class="entry-controls">
        <!-- DELETE REPORT CARD BUTTON   -->
        <!-- only for authoring user  -->
        <% if (reportcard.authorUserId.equals(user && user._id)) { %>
        <form action="/reportcards/<%=reportcard._id%>?_method=DELETE" method="POST">
          <button class="danger tiny" title="Delete Report"><span class="material-icons"> clear </span></button>
        </form>
        <% } %>
      </div>
    </li>
    <%}%> <% }) %>
  </ul>
</div>
<!-- display MAP showing THIS PLACE and USER LOCATION -->
<div id="map"></div>

<script defer src="/js/scripts.js"></script>
<!-- MAP API -->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB2CGd_TVDT97bT076IBQWpm3h3gFtZGJM&&libraries=&v=weekly"></script>

<%- include('../partials/bottom.ejs') %>
